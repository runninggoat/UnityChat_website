(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{122:function(e,t,a){e.exports=a(228)},127:function(e,t,a){},155:function(e,t,a){},223:function(e,t,a){},225:function(e,t,a){},228:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),r=a(9),i=a.n(r),l=(a(127),a(21)),c=a(22),o=a(25),p=a(23),u=a(26),d=a(233),h=a(234),m=a(39),g=a(57),y="update_global",f="update_nickname",v="push_chat",b={nickname:"",contacts:[],wallet:null,contract:null,chats:{}};var E=Object(g.b)({global:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:var a=Object.assign({},e);return a[t.key]=t.value,a;case f:for(var n=Object.assign({},e),s=0;s<n.contacts.length;s++)n.contacts[s].address===t.address&&(n.contacts[s].name=t.name);return n;case v:var r=Object.assign({},e);return r.chats[t.address]=t.messages,r;default:return e}}}),k=Object(g.c)(E,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),C=(a(74),a(13)),j=(a(52),a(14)),w=(a(229),a(97)),O=(a(76),a(10)),N=(a(77),a(16)),S=(a(78),a(11)),M=(a(150),a(120)),x=(a(53),a(34)),D=(a(79),a(27)),_=(a(155),D.a.Header),A=D.a.Content,q=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(o.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={showModal:!1,newAddr:""},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"handleOk",value:function(){this.setState({showModal:!1}),this.props.handleDisplay(J,this.state.newAddr)}},{key:"handleCancel",value:function(){this.setState({showModal:!1})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"contac-list"},s.a.createElement(M.a,{title:"Chat with ...",visible:this.state.showModal,onOk:this.handleOk.bind(this),onCancel:this.handleCancel.bind(this)},s.a.createElement(x.a,{placeholder:"Other Ethereum address",value:this.state.newAddr,onChange:function(t){var a=t.target.value;e.setState({newAddr:a})}})),s.a.createElement(D.a,null,s.a.createElement(_,{className:"header"},s.a.createElement(N.a,{justify:"start"},s.a.createElement(S.a,{span:5,className:"sub2"},"Contacts"),s.a.createElement(S.a,{span:14,className:"sub1"},"UnityChat"),s.a.createElement(S.a,{span:5,className:"sub2",onClick:function(){e.props.handleDisplay(z)}},"Settings"))),s.a.createElement(A,{className:"content"},s.a.createElement(w.a,{itemLayout:"horizontal",dataSource:this.props.contacts,renderItem:function(t){return s.a.createElement(w.a.Item,{onClick:function(){e.props.handleDisplay(J,t.address)}},s.a.createElement(N.a,{justify:"start",align:"middle"},s.a.createElement(S.a,{span:4},s.a.createElement(O.a,{type:"user"})),s.a.createElement(S.a,{span:7},s.a.createElement("span",null,t.name.length>4?t.name.substring(0,4)+"...":t.name)),s.a.createElement(S.a,{span:13},s.a.createElement("span",null,t.address.substring(0,8)+"..."+t.address.substring(36)))))}}),s.a.createElement(j.a,{className:"add-contact",type:"primary",shape:"circle",icon:"plus",onClick:function(){e.setState({showModal:!0})}}))))}}]),t}(n.Component),B=(a(223),D.a.Header),F=D.a.Content,I=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(o.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={loading:!1,text:"",nickname:""},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.requestNickname(),this.requestMessages()}},{key:"requestNickname",value:function(){for(var e=this,t=this.props.global.contacts,a=0;a<t.length;a++)if(t[a].address===this.props.address&&t[a].name.length>0)return void this.setState({nickname:t[a].name});this.props.global.contract.getNickname(this.props.address).catch(function(t){C.a.error("Please provide valid address"),e.props.handleDisplay(Y)}).then(function(t){e.setState({nickname:t}),e.props.updateNickname(e.props.address,t)})}},{key:"requestContacts",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.global.contacts.length>0&&!t||(this.setState({loading:!0}),this.props.global.contract.getContacts().catch(function(e){C.a.error("Fail to retrive data")}).then(function(t){if(e.setState({loading:!1}),t){var a=t.map(function(t){for(var a="",n=e.props.global.contacts,s=0;s<n.length;s++)if(t===n[s].address){a=n[s].name;break}return{name:a,address:t}});e.props.set("contacts",a)}else C.a.error("Fail to retrive data")}))}},{key:"requestMessages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.global.chats[this.props.address]&&!t||(console.log("request messages for chat with address",this.props.address),this.props.global.contract.getChatHistory(this.props.address).catch(function(e){C.a.error("Fail to retrive data")}).then(function(t){if(!t)return C.a.error("Please provide valid address"),void e.props.handleDisplay(Y);var a=t.map(function(e){return{type:0===e.attr?$:V,content:e.content}});e.props.pushMessages(e.props.address,a),e.forceUpdate()}))}},{key:"renderMessages",value:function(){for(var e=[],t=this.props.global.chats[this.props.address],a=0;a<t.length;a++)switch(t[a].type){case V:e.push(s.a.createElement(N.a,{justify:"start",key:a,className:"message"},s.a.createElement(S.a,{span:3},s.a.createElement("div",{className:"avatar"},this.state.nickname?this.state.nickname.substring(0,1):"X")),s.a.createElement(S.a,{span:21},s.a.createElement("div",{className:"left-tip"}),s.a.createElement("div",{className:"cont"},t[a].content))));break;case $:e.push(s.a.createElement(N.a,{justify:"end",key:a,className:"message"},s.a.createElement(S.a,{span:21},s.a.createElement("div",{className:"cont"},t[a].content),s.a.createElement("div",{className:"right-tip"})),s.a.createElement(S.a,{span:3},s.a.createElement("div",{className:"avatar",style:{float:"right"}},this.props.global.nickname?this.props.global.nickname.substring(0,1):"Y"))))}return e.length<1&&(e=null),e}},{key:"sendMessage",value:function(){var e=this;this.setState({loading:!0}),this.props.global.contract.sendMessage(this.props.address,this.state.text).catch(function(e){C.a.error("Connection loss, please refresh page")}).then(function(t){console.log("send message","https://ropsten.etherscan.io/tx/"+t.hash),t.wait().catch(function(t){C.a.error(t),e.setState({loading:!1})}).then(function(t){console.log("Refresh messages ..."),e.requestMessages(!0),e.requestContacts(!0),e.setState({loading:!1,text:""})})})}},{key:"render",value:function(){var e=this,t=null;this.props.global.chats[this.props.address]&&(t=this.renderMessages());var a=null;return this.state.loading&&(a=s.a.createElement("div",null,"Sending...")),s.a.createElement("div",{className:"chat"},s.a.createElement(D.a,null,s.a.createElement(B,{className:"header"},s.a.createElement(N.a,{justify:"start"},s.a.createElement(S.a,{span:2,onClick:function(){e.state.loading||e.props.handleDisplay(Y)}},s.a.createElement(O.a,{type:"left",className:"goback"})),s.a.createElement(S.a,{span:12,className:"opponent"},this.state.nickname?this.state.nickname:"Stranger"),s.a.createElement(S.a,{offset:8,span:2,onClick:function(){return e.requestMessages(!0)}},s.a.createElement(O.a,{type:"sync",className:"sync"})))),s.a.createElement(F,{className:"content"},t,s.a.createElement("div",{className:"bottom-sender"},s.a.createElement(N.a,{justify:"start"},s.a.createElement(S.a,{span:20},s.a.createElement(x.a.TextArea,{disabled:this.state.loading,placeholder:"Your message ...",maxLength:"200",value:this.state.text,onChange:function(t){var a=t.target.value;e.setState({text:a})}})),s.a.createElement(S.a,{span:4,style:{textAlign:"center"}},s.a.createElement(j.a,{disabled:this.state.loading,type:"primary",shape:"circle",icon:"mail",onClick:function(){e.sendMessage()}}),a))))))}}]),t}(n.Component),T=Object(m.b)(function(e,t){return{global:e.global}},function(e,t){return{set:function(t,a){e({type:y,key:t,value:a})},updateNickname:function(t,a){e({type:f,address:t,name:a})},pushMessages:function(t,a){e({type:v,address:t,messages:a})}}})(I),R=a(71),W=(a(225),[{constant:!1,inputs:[],name:"close",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_message",type:"string"}],name:"sendMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"_nickname",type:"string"}],name:"updateNickname",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{payable:!1,stateMutability:"nonpayable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"_from",type:"address"},{indexed:!0,name:"_to",type:"address"}],name:"MsgSent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"_addr",type:"address"}],name:"NickModify",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"_log",type:"bytes"}],name:"log_string",type:"event"},{constant:!0,inputs:[{name:"_to",type:"address"}],name:"getChatHistory",outputs:[{components:[{name:"attr",type:"uint8"},{name:"content",type:"string"}],name:"",type:"tuple[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"getContacts",outputs:[{name:"",type:"address[]"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_to",type:"address"}],name:"getNickname",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"}]),H=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(o.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={privateKey:""},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"renderItem",value:function(){var e=this;return this.props.signin?s.a.createElement(N.a,{justify:"start",gutter:4},s.a.createElement(S.a,{span:24,style:{textAlign:"left"}},s.a.createElement("div",{className:"wallet"},"Wallet: ",this.props.global&&this.props.global.wallet?this.props.global.wallet.address:""))):s.a.createElement(N.a,{justify:"start",gutter:4},s.a.createElement(S.a,{span:24,style:{textAlign:"left"}},"Sgin in with private key"),s.a.createElement(S.a,{span:22},s.a.createElement(x.a,{prefix:s.a.createElement(O.a,{type:"key"}),placeholder:"Your private key",value:this.state.privateKey,onChange:function(t){var a=t.target.value;e.setState({privateKey:a})}})),s.a.createElement(S.a,{span:2,style:{textAlign:"center"}},s.a.createElement(j.a,{type:"primary",shape:"circle",icon:"check",onClick:function(){e.props.loginWallet(e.state.privateKey)}})))}},{key:"render",value:function(){var e=this.renderItem();return s.a.createElement("div",null,e)}}]),t}(n.Component),L=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(o.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={editing:!1,nickname:""},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"renderItem",value:function(){var e=this;return this.state.editing?s.a.createElement(N.a,{justify:"start",gutter:4},s.a.createElement(S.a,{span:24,style:{textAlign:"left"}},"Edit your nickname"),s.a.createElement(S.a,{span:19},s.a.createElement(x.a,{prefix:s.a.createElement(O.a,{type:"user"}),placeholder:"Your nickname",value:this.state.nickname,onChange:function(t){var a=t.target.value;e.setState({nickname:a})}})),s.a.createElement(S.a,{span:5,style:{textAlign:"center"}},s.a.createElement(j.a,{type:"primary",shape:"circle",icon:"check",onClick:function(){e.props.updateNickname(e.state.nickname),e.setState({editing:!1})}}),s.a.createElement(j.a,{type:"danger",shape:"circle",icon:"close",onClick:function(){e.setState({editing:!1})}}))):s.a.createElement(N.a,{justify:"start",gutter:4},s.a.createElement(S.a,{span:24,style:{textAlign:"left"}},s.a.createElement(N.a,{justify:"start",className:"nickname"},s.a.createElement(S.a,{span:22,style:{textAlign:"left"}},s.a.createElement("div",null,"Nickname: ",this.props.global?this.props.global.nickname:"")),s.a.createElement(S.a,{span:2,style:{textAlign:"right"}},s.a.createElement(j.a,{disabled:this.props.loading,type:"primary",shape:"circle",icon:"edit",onClick:function(){e.setState({editing:!0})}})))))}},{key:"render",value:function(){var e=this.renderItem();return s.a.createElement("div",null,e)}}]),t}(n.Component),P=D.a.Header,X=D.a.Content,K=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(o.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={signin:!1,loading:!1},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.global.wallet&&this.setState({signin:!0})}},{key:"loginWallet",value:function(e){var t,a=this,n=new R.ethers.providers.JsonRpcProvider("https://ropsten.infura.io/v3/9587616e1d9c4c44a3f3f957d721e15e");try{t=new R.ethers.Wallet(e,n)}catch(r){return void C.a.error("Please provide valid private key")}this.props.set("wallet",t);var s=new R.ethers.Contract("0x127c08af8ce6e7fae914efeeb35398f2a9479c39",W,n).connect(t);this.props.set("contract",s),this.setState({loading:!0}),s.getNickname(t.address).catch(function(e){C.a.error("Connection loss, please refresh page")}).then(function(e){a.props.set("nickname",e),a.setState({loading:!1})}),s.getContacts().catch(function(e){C.a.error("Connection loss, please refresh page")}).then(function(e){if(e){console.log(e);var t=e.map(function(e){return{name:"",address:e}});a.props.set("contacts",t)}else C.a.error("Connection loss, please refresh page")}),this.setState({signin:!0})}},{key:"renderNicknameController",value:function(){var e=null;return this.state.signin&&(e=s.a.createElement(L,{loading:this.state.loading,global:this.props.global,updateNickname:this.updateNickname.bind(this)})),e}},{key:"updateNickname",value:function(e){var t=this;this.setState({loading:!0}),this.props.global.contract.updateNickname(e).catch(function(e){C.a.error("Connection loss, please refresh page")}).then(function(e){console.log("update nickname","https://ropsten.etherscan.io/tx/"+e.hash),e.wait().catch(function(e){C.a.error(e),t.setState({loading:!1})}).then(function(e){t.props.global.contract.getNickname(t.props.global.wallet.address).catch(function(e){C.a.error("Connection loss, please refresh page")}).then(function(e){t.props.set("nickname",e),t.setState({loading:!1})})})})}},{key:"renderRefreshContacts",value:function(){var e=this,t=null;return this.state.signin&&(t=s.a.createElement(N.a,{justify:"center",style:{margin:"5px 0"}},s.a.createElement(S.a,{span:24},s.a.createElement(j.a,{disabled:this.state.loading,type:"primary",onClick:function(){e.requestContacts(!0)},style:{width:"100%"}},"Refresh contacts")))),t}},{key:"requestContacts",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.global.contacts.length>0&&!t||(this.setState({loading:!0}),this.props.global.contract.getContacts().catch(function(e){C.a.error("Connection loss, please refresh page")}).then(function(t){if(e.setState({loading:!1}),t){var a=t.map(function(t){for(var a="",n=e.props.global.contacts,s=0;s<n.length;s++)if(t===n[s].address){a=n[s].name;break}return{name:a,address:t}});e.props.set("contacts",a),C.a.info("Refresh contacts successfully")}else C.a.error("Connection loss, please refresh page")}))}},{key:"render",value:function(){var e=this,t=this.renderNicknameController(),a=this.renderRefreshContacts();return s.a.createElement("div",{className:"setting"},s.a.createElement(D.a,null,s.a.createElement(P,{className:"header"},s.a.createElement(N.a,{justify:"start"},s.a.createElement(S.a,{span:2,onClick:function(){e.state.loading||e.props.handleDisplay(Y)}},s.a.createElement(O.a,{type:"left",className:"goback"})),s.a.createElement(S.a,{span:12,className:"title"},"Settings"))),s.a.createElement(X,{className:"content"},s.a.createElement(H,{signin:this.state.signin,global:this.props.global,loginWallet:this.loginWallet.bind(this)}),t,a,s.a.createElement(N.a,{justify:"center",style:{margin:"5px 0"}},s.a.createElement(S.a,{span:24,style:{textAlign:"left"}},s.a.createElement("span",null,"Test private key 1")),s.a.createElement(S.a,{span:24},s.a.createElement(x.a,{readOnly:!0,value:"5673F90E7755590D098B57867459BAC033B588CE083C3CD87C8B5EBE7C5032F7"}))),s.a.createElement(N.a,{justify:"center",style:{margin:"5px 0"}},s.a.createElement(S.a,{span:24,style:{textAlign:"left"}},s.a.createElement("span",null,"Test private key 2")),s.a.createElement(S.a,{span:24},s.a.createElement(x.a,{readOnly:!0,value:"76F0CE5A1FBC853FBFDE9DF93BE00A032AD833434D89C96D71CBA5616E36D9CA"}))))))}}]),t}(n.Component),U=Object(m.b)(function(e,t){return{global:e.global}},function(e,t){return{set:function(t,a){e({type:y,key:t,value:a})}}})(K),Y="contact_list",J="chat_room",z="settings",V="message_oppo",$="message_self",G=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(o.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={display:Y,address:"",nameMap:{}},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.global.wallet||(C.a.info("Please login with your private key"),setTimeout(function(){e.setState({display:z})},200))}},{key:"processNameMapping",value:function(e){for(var t=Object.assign({},this.state.nameMap),a=!1,n=0;n<e.length;n++)t[e[n].address]!==e[n].name&&(t[e[n].address]=e[n].name,a=!0);a&&this.setState({nameMap:t})}},{key:"handleDisplay",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t?this.setState({display:e,address:t}):this.setState({display:e})}},{key:"switchDisplay",value:function(){var e=this,t=null;switch(this.state.display){case Y:t=s.a.createElement(q,{contacts:this.props.global.contacts,handleDisplay:this.handleDisplay.bind(this)}),setTimeout(function(){e.processNameMapping(e.props.global.contacts)},300);break;case J:t=s.a.createElement(T,{address:this.state.address,nickname:this.state.nameMap[this.state.address],handleDisplay:this.handleDisplay.bind(this)});break;case z:t=s.a.createElement(U,{handleDisplay:this.handleDisplay.bind(this)})}return t}},{key:"render",value:function(){var e=this.switchDisplay();return s.a.createElement("div",null,e)}}]),t}(n.Component),Q=Object(m.b)(function(e,t){return{global:e.global}},function(e,t){return{set:function(t,a){e({type:y,key:t,value:a})},pushMessages:function(t,a){e({type:v,address:t,messages:a})}}})(G),Z=function(e){function t(){return Object(l.a)(this,t),Object(o.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement(m.a,{store:k},s.a.createElement(d.a,null,s.a.createElement("div",null,s.a.createElement(h.a,{exact:!0,path:"/",component:Q}))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ee(){i.a.render(s.a.createElement(Z,null),document.getElementById("root"))}ee(),window.addEventListener("resize",ee),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[122,2,1]]]);
//# sourceMappingURL=main.05a02231.chunk.js.map